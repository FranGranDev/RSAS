# Контекст проекта для AI-ассистента

## Общая информация о проекте
- Название проекта: Система анализа заказов и продаж
- Цель проекта: Разработка современного приложения для анализа заказов и продаж с разделением на Backend и Frontend
- Текущий статус: Backend (WEB API) готов и находится в стадии первичного тестирования, Frontend часть в процессе разработки
- Основные технологии: 
  - Backend: ASP.NET Core Web API
  - Frontend: ASP.NET Core Razor Pages
  - База данных: SQL Server
- Приложение рассчитано ТОЛЬКО на розничные продажи для физических лиц
- Оптовые продажи и работа с юридическими лицами исключены из функционала

## Требования к проекту

### Функциональные требования
1. **Управление заказами**:
   - Создание, редактирование, удаление заказов
   - Отслеживание статуса заказов
   - Управление доставкой
   - Фильтрация и поиск заказов

2. **Управление продажами**:
   - Создание продаж на основе заказов
   - Учет скидок и бонусов
   - Аналитика продаж
   - Отчеты по продажам

3. **Управление товарами**:
   - Учет товаров на складах
   - Управление ценами
   - Категоризация товаров
   - Отслеживание остатков

4. **Аналитика**:
   - Дашборд с ключевыми показателями
   - Анализ продаж и заказов
   - Отчеты и графики
   - Прогнозирование

### Нефункциональные требования
1. **Производительность**:
   - Время отклика API < 500мс
   - Поддержка 100+ одновременных пользователей
   - Кэширование часто используемых данных

2. **Безопасность**:
   - JWT аутентификация
   - Ролевой доступ
   - Валидация входных данных
   - Защита от SQL-инъекций

3. **Масштабируемость**:
   - Модульная архитектура
   - Возможность горизонтального масштабирования
   - Поддержка больших объемов данных

## Архитектурные решения
1. Разделение на Backend и Frontend:
   - Backend (Server): REST API
   - Frontend: Razor Pages с использованием API
   - Взаимодействие через HTTP запросы

2. Frontend архитектура:
   - Использование Razor Pages вместо SPA
   - Серверный рендеринг для лучшей производительности
   - Встроенная поддержка Identity
   - Использование Tag Helpers
   - Встроенная валидация форм
   - Компонентный подход к сервисам:
     - `ApiService` - базовый сервис для HTTP запросов
     - `AuthService` - сервис аутентификации
     - `ClientService` - сервис для работы с клиентами
   - Улучшенная обработка ошибок:
     - Toastr уведомления
     - Централизованная обработка ошибок API
     - Валидация форм на стороне клиента

3. Backend архитектура:
   - REST API с использованием контроллеров
   - Swagger для документации API
   - JWT аутентификация
   - Entity Framework Core для работы с БД
   - Ролевая модель с двумя уровнями доступа:
     - Manager (Менеджер) - полный доступ к системе
     - User (Пользователь) - ограниченный доступ к функционалу

## Последние изменения [08.04.2024]

### Frontend [UI][API]
1. **Улучшение профиля пользователя**:
   - Создан отдельный `ProfileFormDto` для формы профиля
   - Улучшена валидация данных
   - Добавлена обработка ошибок
   - Реализовано автоматическое создание профиля клиента

2. **Улучшение сервисов**:
   - Рефакторинг `ApiService`:
     - Поддержка разных типов для запросов и ответов
     - Улучшенная обработка ошибок
     - Более гибкая конфигурация
   - Улучшение `ClientService`:
     - Использование композиции вместо наследования
     - Более чистый интерфейс
     - Лучшая обработка ошибок

3. **Улучшение UI**:
   - Добавлены toastr уведомления
   - Улучшена валидация форм
   - Более информативные сообщения об ошибках

### Backend [API][БД]
1. **Улучшение контроллеров**:
   - Добавлен метод `GetCurrentClient` в `ClientsController`
   - Улучшена обработка ошибок
   - Более информативные ответы

2. **Улучшение DTO**:
   - Удален ненужный атрибут `[Required]` для `Id` в `ClientDto`
   - Создан отдельный `ProfileFormDto` для формы профиля
   - Улучшена валидация данных

## Текущие задачи и приоритеты

### Высокий приоритет [Срочно]
- [API] Реализация аналитики продаж
- [БД] Оптимизация запросов
- [Безопасность] Улучшение валидации
- [UI] Улучшение профиля пользователя
- [API] Документация API

### Средний приоритет
- [UI] Улучшение интерфейса
- [Тестирование] Добавление unit-тестов
- [Документация] Обновление API docs
- [UI] Добавление новых страниц

### Низкий приоритет
- [Оптимизация] Рефакторинг кода
- [UI] Добавление анимаций
- [Документация] Улучшение README

## Важные замечания и предпочтения
- Сохранение существующей функциональности при миграции
- Обеспечение масштабируемости новой архитектуры
- Безопасность и надежность системы
- Плавный переход на новую архитектуру
- Использование современных практик разработки
- Фокус на удобстве использования и производительности

## История изменений

### 07.04.2024 [API][БД][Безопасность]
1. **Модели данных**:
   - [БД] Добавлены virtual свойства для навигации
   - [БД] Обновлены связи между моделями
   - [БД] Добавлены новые поля для аналитики

2. **API**:
   - [API] Добавлены новые эндпоинты для аналитики
   - [API] Улучшена обработка ошибок
   - [API] Оптимизированы запросы к БД

3. **Безопасность**:
   - [Безопасность] Улучшена валидация входных данных
   - [Безопасность] Добавлены новые политики авторизации
   - [Безопасность] Обновлены роли пользователей

### 06.04.2024 [Архитектура][БД][Тестирование]
1. **Архитектура**:
   - [Архитектура] Разделение на Backend и Frontend
   - [Архитектура] Настройка CORS
   - [Архитектура] Добавление Swagger

2. **База данных**:
   - [БД] Создание миграций
   - [БД] Настройка связей
   - [БД] Добавление индексов

3. **Тестирование**:
   - [Тестирование] Настройка тестового окружения
   - [Тестирование] Создание базовых тестов
   - [Тестирование] Настройка CI/CD

## Текущие задачи и приоритеты [План][Задачи]

### Высокий приоритет [Срочно]
- [API] Реализация аналитики продаж
- [БД] Оптимизация запросов
- [Безопасность] Улучшение валидации

### Средний приоритет
- [UI] Улучшение интерфейса
- [Тестирование] Добавление unit-тестов
- [Документация] Обновление API docs

### Низкий приоритет
- [Оптимизация] Рефакторинг кода
- [UI] Добавление анимаций
- [Документация] Улучшение README

## Принятые решения [Архитектура][План]

### Backend [API][Безопасность]
- [API] REST API с использованием контроллеров
- [Безопасность] JWT аутентификация
- [БД] Entity Framework Core

### Frontend [UI][Архитектура]
- [UI] Razor Pages
- [Архитектура] Серверный рендеринг
- [Безопасность] Встроенная поддержка Identity

## Важные заметки [Безопасность][БД]

### Безопасность [Критично]
- [Безопасность] Все пароли хешируются
- [Безопасность] JWT токены с ограниченным сроком
- [Безопасность] Защита от CSRF

### Производительность [Оптимизация]
- [БД] Индексы на часто используемых полях
- [API] Кэширование часто запрашиваемых данных
- [UI] Оптимизация загрузки страниц

## Критерии качества [Тестирование][Безопасность]

### Тестирование [Критично]
- [Тестирование] Покрытие кода > 80%
- [Тестирование] Автоматизированные тесты
- [Тестирование] Интеграционные тесты

### Безопасность [Критично]
- [Безопасность] Регулярные аудиты
- [Безопасность] Обновление зависимостей
- [Безопасность] Мониторинг логов

## Дополнительная информация [Документация]

### Документация [Важно]
- [Документация] Swagger UI
- [Документация] Комментарии в коде
- [Документация] Руководство пользователя

## План разработки на следующие 2 месяца [План]

### Месяц 1 [API][UI]
- [API] Реализация аналитики
- [UI] Улучшение интерфейса
- [Тестирование] Добавление тестов

### Месяц 2 [Безопасность][Оптимизация]
- [Безопасность] Улучшение безопасности
- [Оптимизация] Оптимизация производительности
- [Документация] Обновление документации

## Учетные данные для тестирования
- Менеджер:
  - Email: Manager@gmail.com
  - Password: Manager123
- Клиент:
  - Email: Client@gmail.com
  - Password: Client123

## Документация API

### Аутентификация
```
POST /api/auth/login
- Описание: Вход в систему
- Параметры: email, password
- Ответ: JWT токен

POST /api/auth/register
- Описание: Регистрация нового пользователя
- Параметры: email, password, role
- Ответ: JWT токен
```

### Заказы
```
GET /api/orders
- Описание: Получение списка заказов
- Параметры: фильтры, сортировка, пагинация
- Ответ: список заказов

POST /api/orders
- Описание: Создание нового заказа
- Параметры: данные заказа
- Ответ: созданный заказ
```

### Продажи
```
GET /api/sales
- Описание: Получение списка продаж
- Параметры: фильтры, сортировка, пагинация
- Ответ: список продаж

POST /api/sales
- Описание: Создание новой продажи
- Параметры: данные продажи
- Ответ: созданная продажа
``` 