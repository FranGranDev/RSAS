# Контекст проекта для AI-ассистента

## Общая информация о проекте
- Название проекта: Система анализа заказов и продаж
- Цель проекта: Разработка современного приложения для анализа заказов и продаж с разделением на Backend и Frontend
- Текущий статус: Начальная стадия разделения проекта
- Основные технологии: 
  - Backend: ASP.NET Core Web API
  - Frontend: ASP.NET Core Razor Pages
  - База данных: SQL Server
- Приложение рассчитано ТОЛЬКО на розничные продажи для физических лиц
- Оптовые продажи и работа с юридическими лицами исключены из функционала

## Архитектурные решения
1. Разделение на Backend и Frontend:
   - Backend (Server): REST API
   - Frontend: Razor Pages с использованием API
   - Взаимодействие через HTTP запросы

2. Frontend архитектура:
   - Использование Razor Pages вместо SPA
   - Серверный рендеринг для лучшей производительности
   - Встроенная поддержка Identity
   - Использование Tag Helpers
   - Встроенная валидация форм

3. Backend архитектура:
   - REST API с использованием контроллеров
   - Swagger для документации API
   - JWT аутентификация
   - Entity Framework Core для работы с БД

## Текущие задачи и приоритеты
1. Разделение проекта на Server и Frontend
   - Статус: В процессе
   - Приоритет: Высокий
   - Зависимости: 
     - Создание базовой структуры проектов
     - Настройка взаимодействия между частями
     - Перенос моделей данных
     - Создание API контроллеров

2. Миграция функционала
   - Статус: Запланировано
   - Приоритет: Высокий
   - Зависимости:
     - Перенос бизнес-логики в API
     - Адаптация Frontend для работы с API
     - Настройка аутентификации

3. Тестирование и отладка
   - Статус: Запланировано
   - Приоритет: Средний
   - Зависимости:
     - Настройка тестового окружения
     - Проверка взаимодействия частей
     - Исправление ошибок

## Принятые решения
- Использование Razor Pages для Frontend вместо SPA
- Разделение на Backend API и Frontend
- Использование JWT для аутентификации
- Swagger для документации API
- Entity Framework Core для работы с БД
- Поэтапная миграция функционала

## Важные замечания и предпочтения
- Сохранение существующей функциональности при миграции
- Обеспечение масштабируемости новой архитектуры
- Безопасность и надежность системы
- Плавный переход на новую архитектуру

## История изменений
- 01.04.2025 - Создание документа с контекстом проекта
- 01.04.2025 - Определение основных задач и приоритетов
- 01.04.2025 - Принятие решения о разделении на Backend и Frontend
- 01.04.2025 - Выбор Razor Pages для Frontend
- 01.04.2025 - Создание базовой структуры проектов
- 01.04.2025 - Фокус на разделении проекта и миграции функционала
- 01.04.2025 - Реализована базовая структура для работы с заказами:
  - Создан ApiService для взаимодействия с Backend API
  - Реализована JWT аутентификация
  - Созданы страницы для работы с заказами (Index, Create, Edit, Details)
  - Настроена валидация форм
  - Реализована обработка ошибок
  - Добавлена навигация между страницами
  - Настроен макет приложения с меню
- 01.04.2025 - Реализована структура для работы с продажами:
  - Использована существующая модель Sale с полями Id, OrderId, StockId, SaleDate, SaleType
  - Созданы DTO для API (SaleDto, CreateSaleDto, UpdateSaleDto)
  - Расширен интерфейс ISalesStore методом Delete
  - Реализован контроллер SalesController с CRUD операциями
  - Добавлена защита API с помощью JWT аутентификации
  - Настроены связи с заказами и складами
- 01.04.2025 - Созданы DTO для всех моделей:
  - Заказы (OrderDto, CreateOrderDto, UpdateOrderDto)
  - Доставка (DeliveryDto, CreateDeliveryDto, UpdateDeliveryDto)
  - Товары в заказе (OrderProductDto, CreateOrderProductDto, UpdateOrderProductDto)
  - Склады (StockDto, CreateStockDto, UpdateStockDto)
  - Товары на складе (StockProductDto, CreateStockProductDto, UpdateStockProductDto)
  - Товары (ProductDto, CreateProductDto, UpdateProductDto)
- 01.04.2025 - Настроена аутентификация и авторизация:
  - Создан сервис JwtService для работы с JWT токенами
  - Реализованы DTO для аутентификации (LoginDto, RegisterDto, AuthResponseDto, UserDto)
  - Создан контроллер AuthController с методами:
    - POST /api/auth/login - вход в систему
    - POST /api/auth/register - регистрация
    - GET /api/auth/me - получение информации о текущем пользователе
  - Добавлены политики авторизации:
    - RequireAdminRole - только для администраторов
    - RequireManagerRole - для администраторов и менеджеров
    - RequireUserRole - для всех авторизованных пользователей
  - Настроена валидация входных данных
  - Реализована обработка ошибок аутентификации
- 01.04.2025 - Удаление логики оптовых продаж:
  - Удалена логика оптовых продаж из проекта
  - Обновлены модели и DTO для соответствия новой структуре
  - Упрощена модель ценообразования (единое поле цены)

- 01.04.2025 - Создание DTO и контроллеров:
  - Созданы DTO для клиентов и сотрудников
  - Реализованы контроллеры:
    - `ClientsController` с CRUD операциями
    - `EmployeesController` с CRUD операциями
  - Обновлен `ProductsController` для работы с единым полем цены
  - Настроена авторизация и политики доступа

- 01.04.2025 - Исправление проблем с файлами проекта:
  - Обнаружена проблема в Rider с поиском `Server.csproj`
  - Файл проекта переименован из `Application.csproj` в `Server.csproj`
  - Обновлены ссылки в файле решения
  - Удален лишний файл решения `Application.sln`
  - Оставлен только `RSAS.sln` в корневой директории

## Критерии качества
- Корректная работа всех функций после миграции
- Безопасность данных и аутентификации
- Надежность и отказоустойчивость
- Производительность API
- Удобство поддержки кода

## Дополнительная информация
- Проект является модернизацией существующего решения
- Необходимо обеспечить плавный переход на новую архитектуру
- Важно сохранить все существующие функции при миграции
- Требуется тщательное тестирование на каждом этапе разработки
- Необходимо обеспечить обратную совместимость API 

## План разработки (2 месяца)
### Месяц 1
1. Неделя 1-2:
   - [x] Разделение проекта на Server и Frontend
   - [x] Настройка базовой структуры
   - [x] Реализация базового функционала заказов
   - [ ] Настройка аутентификации и авторизации

2. Неделя 3-4:
   - [ ] Реализация функционала продаж
   - [ ] Реализация функционала товаров
   - [ ] Интеграция всех компонентов
   - [ ] Базовое тестирование

### Месяц 2
1. Неделя 1-2:
   - [ ] Расширенное тестирование
   - [ ] Оптимизация производительности
   - [ ] Улучшение UI/UX
   - [ ] Документация

2. Неделя 3-4:
   - [ ] Финальное тестирование
   - [ ] Исправление багов
   - [ ] Подготовка к развертыванию
   - [ ] Финальная документация

## Текущий прогресс
### Выполнено
- [x] Создание базовой структуры проектов
- [x] Настройка взаимодействия между частями
- [x] Реализация базового функционала заказов
- [x] Настройка JWT аутентификации
- [x] Создание базового UI
- [x] Удаление логики оптовых продаж
- [x] Создание DTO и контроллеров для клиентов и сотрудников
- [x] Исправление проблем с файлами проекта

### В процессе
- [ ] Реализация функционала продаж
- [ ] Реализация функционала товаров
- [ ] Расширенное тестирование

### Запланировано
- [ ] Оптимизация производительности
- [ ] Улучшение UI/UX
- [ ] Документация
- [ ] Развертывание

## Известные проблемы и задачи
1. Высокий приоритет:
   - [ ] Реализация функционала продаж
   - [ ] Реализация функционала товаров
   - [ ] Расширенное тестирование

2. Средний приоритет:
   - [ ] Оптимизация производительности
   - [ ] Улучшение UI/UX
   - [ ] Документация

3. Низкий приоритет:
   - [ ] Дополнительные функции
   - [ ] Улучшение отчетности
   - [ ] Оптимизация базы данных

## Технический долг
- [ ] Добавить логирование
- [ ] Улучшить обработку ошибок
- [ ] Добавить кэширование
- [ ] Оптимизировать запросы к БД
- [ ] Добавить unit-тесты

## Следующие шаги
1. Реализация функционала продаж:
   - Создание моделей данных
   - Реализация API
   - Создание UI компонентов
   - Интеграция с существующим функционалом

2. Реализация функционала товаров:
   - Создание моделей данных
   - Реализация API
   - Создание UI компонентов
   - Интеграция с заказами и продажами

3. Тестирование:
   - Написание unit-тестов
   - Интеграционное тестирование
   - UI тестирование
   - Нагрузочное тестирование 